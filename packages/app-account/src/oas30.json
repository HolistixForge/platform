{
  "openapi": "3.0.1",
  "info": {
    "title": "account API",
    "version": "1.0"
  },
  "paths": {
    "/me": {
      "post": {
        "summary": "test logged in",
        "responses": {
          "200": {
            "description": "user session data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {},
                  "additionalProperties": true
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/user": {
      "get": {
        "summary": "test logged in",
        "responses": {
          "200": {
            "description": "user session data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {},
                  "additionalProperties": true
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/signup": {
      "post": {
        "summary": "signup new user",
        "description": "",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "$ref": "#/components/schemas/user/properties/email"
                  },
                  "password": {
                    "$ref": "#/components/schemas/user/properties/password"
                  },
                  "username": {
                    "$ref": "#/components/schemas/user/properties/username"
                  },
                  "firstname": {
                    "$ref": "#/components/schemas/user/properties/firstname"
                  },
                  "lastname": {
                    "$ref": "#/components/schemas/user/properties/lastname"
                  }
                },
                "required": [
                  "email",
                  "password",
                  "username"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/login": {
      "post": {
        "summary": "login user",
        "description": "",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "$ref": "#/components/schemas/user/properties/email"
                  },
                  "password": {
                    "type": "string"
                  }
                },
                "required": [
                  "email",
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/logout": {
      "post": {
        "summary": "logout user",
        "description": "",
        "parameters": [],
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/password": {
      "post": {
        "summary": "change password",
        "description": "",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "password": {
                    "$ref": "#/components/schemas/user/properties/password"
                  }
                },
                "required": [
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/github": {
      "get": {
        "summary": "authenticate with github",
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/github/callback": {
      "get": {
        "summary": "authenticate with github",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "description": "the code to be exchanged for a token.",
            "required": true,
            "schema": {
              "type": "string",
              "example": "a4bd4a782344ee6bc91b"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/gitlab": {
      "get": {
        "summary": "authenticate with gitlab",
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/gitlab/callback": {
      "get": {
        "summary": "authenticate with gitlab",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "description": "the code to be exchanged for a token.",
            "required": true,
            "schema": {
              "type": "string",
              "example": "cb156f0ed48ae66e7d3890e8295b9cca120867040ac85710e3a541891669f1d4"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/totp/setup": {
      "post": {
        "summary": "setup Totp",
        "description": "",
        "parameters": [],
        "responses": {
          "200": {
            "description": "user private key",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "otpUrl": {
                      "type": "string"
                    },
                    "key": {
                      "type": "string"
                    }
                  },
                  "additionalProperties": false
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/totp/login": {
      "post": {
        "summary": "Totp check",
        "description": "",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": {
                    "type": "string"
                  }
                },
                "required": [
                  "code"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/magiclink/request": {
      "post": {
        "summary": "request magic link token email",
        "description": "",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "$ref": "#/components/schemas/user/properties/email"
                  },
                  "context": {
                    "type": "string",
                    "enum": [
                      "reset-password",
                      "validate-email"
                    ]
                  }
                },
                "required": [
                  "email"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/magiclink/callback": {
      "get": {
        "summary": "verify magic link token",
        "parameters": [
          {
            "name": "token",
            "in": "query",
            "description": "the token sent by email.",
            "required": false,
            "schema": {
              "type": "string",
              "example": "xxxxxxxxxxxxxxxxxxxxxxxxx"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/oauth/authorize": {
      "get": {
        "summary": "OAuth authorize",
        "parameters": [
          {
            "$ref": "#/components/parameters/redirect_uri"
          },
          {
            "$ref": "#/components/parameters/state"
          },
          {
            "$ref": "#/components/parameters/client_id"
          },
          {
            "$ref": "#/components/parameters/response_type"
          },
          {
            "$ref": "#/components/parameters/scope"
          }
        ],
        "responses": {
          "302": {
            "description": "redirection",
            "headers": {
              "location": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      },
      "post": {
        "summary": "OAuth authorize",
        "parameters": [
          {
            "$ref": "#/components/parameters/redirect_uri"
          },
          {
            "$ref": "#/components/parameters/state"
          },
          {
            "$ref": "#/components/parameters/client_id"
          },
          {
            "$ref": "#/components/parameters/response_type"
          },
          {
            "$ref": "#/components/parameters/scope"
          }
        ],
        "responses": {
          "200": {
            "description": "redirection",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string"
                    },
                    "state": {
                      "type": "string"
                    }
                  },
                  "additionalProperties": false
                }
              }
            }
          },
          "4XX": {
            "description": "redirect url",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "location": {
                      "type": "string"
                    },
                    "redirect": {
                      "type": "string"
                    },
                    "client_id": {
                      "type": "string"
                    },
                    "redirect_uri": {
                      "type": "string"
                    }
                  },
                  "additionalProperties": false
                }
              }
            }
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/oauth/token": {
      "post": {
        "summary": "Exchange a code for a token",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "grant_type": {
                    "type": "string",
                    "enum": [
                      "authorization_code",
                      "refresh_token"
                    ],
                    "example": "authorization_code"
                  },
                  "client_id": {
                    "type": "string",
                    "maxLength": 128,
                    "example": "45d80703-7b38-4381-bdaa-2f7008d0cb75"
                  },
                  "client_secret": {
                    "type": "string",
                    "example": "45d80703-7b38-4381-bdaa-2f7008d0cb75"
                  },
                  "code": {
                    "type": "string",
                    "maxLength": 256,
                    "description": "a code, previously returned by authorize endpoint",
                    "example": "b677ffdb-2a4a-4875-834c-fd2a64262a44"
                  },
                  "redirect_uri": {
                    "type": "string",
                    "maxLength": 256,
                    "pattern": "^([-a-zA-Z0-9()@:%_+.~#?&//=]*)$",
                    "example": "https://domain.com/xxx"
                  },
                  "refresh_token": {
                    "type": "string"
                  }
                },
                "required": [
                  "grant_type"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "token",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {},
                  "additionalProperties": true
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/oauth/public-key": {
      "get": {
        "summary": "get JWT public key",
        "responses": {
          "200": {
            "description": "public key",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "publicKey": {
                      "type": "string"
                    }
                  },
                  "additionalProperties": false
                }
              }
            }
          }
        }
      }
    },
    "/linkedin": {
      "get": {
        "summary": "authenticate with linkedin",
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/linkedin/callback": {
      "get": {
        "summary": "authenticate with linkedin",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "description": "the code to be exchanged for a token.",
            "required": true,
            "schema": {
              "type": "string",
              "example": "AQX1..."
            }
          },
          {
            "name": "state",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/discord": {
      "get": {
        "summary": "authenticate with discord",
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    },
    "/discord/callback": {
      "get": {
        "summary": "authenticate with discord",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "description": "the code to be exchanged for a token.",
            "required": true,
            "schema": {
              "type": "string",
              "example": "discord_code_example"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/empty"
          },
          "4XX": {
            "$ref": "#/components/responses/errors"
          },
          "5XX": {
            "$ref": "#/components/responses/errors"
          }
        }
      }
    }
  },
  "components": {
    "responses": {
      "empty": {
        "description": "ok",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "additionalProperties": false
            }
          }
        }
      },
      "errors": {
        "description": "errors",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/errors"
            }
          }
        }
      }
    },
    "schemas": {
      "Empty": {
        "title": "Empty Schema",
        "type": "object"
      },
      "errors": {
        "type": "object",
        "properties": {
          "uuid": {
            "type": "string"
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string"
                },
                "public": {
                  "type": "boolean"
                },
                "default": {
                  "type": "boolean"
                }
              },
              "additionalProperties": false
            }
          }
        },
        "additionalProperties": false
      },
      "user": {
        "title": "User Schema",
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "password": {
            "type": "string",
            "format": "password"
          },
          "user_id": {
            "description": "User System Id",
            "type": "string",
            "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
            "maxLength": 36,
            "example": "b677ffdb-2a4a-4875-834c-fd2a64262a44"
          },
          "username": {
            "description": "User name (@)",
            "type": "string",
            "maxLength": 50,
            "minLength": 3,
            "pattern": "^[a-zA-Z0-9_]*$",
            "example": "Boby_7891"
          },
          "firstname": {
            "description": "User fistname",
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-zA-Z0-9_]*$",
            "example": "Robert"
          },
          "lastname": {
            "description": "User lastname",
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-zA-Z0-9_]*$",
            "example": "Doe"
          }
        },
        "additionalProperties": false
      }
    },
    "parameters": {
      "redirect_uri": {
        "in": "query",
        "name": "redirect_uri",
        "required": true,
        "schema": {
          "type": "string",
          "maxLength": 256,
          "pattern": "^([-a-zA-Z0-9()@:%_+.~#?&//=]*)$",
          "example": "https://domain.com/xxx"
        }
      },
      "state": {
        "in": "query",
        "name": "state",
        "required": true,
        "schema": {
          "type": "string",
          "maxLength": 300
        }
      },
      "client_id": {
        "in": "query",
        "name": "client_id",
        "required": true,
        "schema": {
          "type": "string",
          "maxLength": 128,
          "example": "45d80703-7b38-4381-bdaa-2f7008d0cb75"
        }
      },
      "response_type": {
        "in": "query",
        "name": "response_type",
        "required": true,
        "schema": {
          "type": "string",
          "enum": [
            "code"
          ],
          "example": "code"
        }
      },
      "scope": {
        "in": "query",
        "name": "scope",
        "schema": {
          "type": "string",
          "maxLength": 128,
          "example": "email+deploy+shutdown"
        }
      }
    }
  }
}
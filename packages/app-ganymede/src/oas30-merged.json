{
  "openapi": "3.0.1",
  "info": {
    "title": "Ganymede API (Merged: Auth + Resources)",
    "version": "2.0",
    "description": "Unified API for authentication and resource management"
  },
  "paths": {
    "/me": {
      "post": {
        "summary": "Get current user session",
        "tags": ["Auth"],
        "responses": {
          "200": {
            "description": "User session data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/signup": {
      "post": {
        "summary": "Sign up new user",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "password": { "type": "string", "minLength": 8 },
                  "username": { "type": "string", "pattern": "^[a-zA-Z0-9_]*$" },
                  "firstname": { "type": "string" },
                  "lastname": { "type": "string" }
                },
                "required": ["email", "password", "username"]
              }
            }
          }
        },
        "responses": {
          "200": { "$ref": "#/components/responses/empty" },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/login": {
      "post": {
        "summary": "Login user",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "password": { "type": "string" }
                },
                "required": ["email", "password"]
              }
            }
          }
        },
        "responses": {
          "200": { "$ref": "#/components/responses/empty" },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/logout": {
      "post": {
        "summary": "Logout user",
        "tags": ["Auth"],
        "responses": {
          "200": { "$ref": "#/components/responses/empty" }
        }
      }
    },
    "/orgs": {
      "get": {
        "summary": "List user's organizations",
        "tags": ["Organizations"],
        "parameters": [{ "$ref": "#/components/parameters/headers_authorization" }],
        "responses": {
          "200": {
            "description": "List of organizations",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "organizations": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/organization" }
                    }
                  }
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      },
      "post": {
        "summary": "Create organization",
        "tags": ["Organizations"],
        "parameters": [{ "$ref": "#/components/parameters/headers_authorization" }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string", "minLength": 1, "maxLength": 100 }
                },
                "required": ["name"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Organization created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "organization_id": { "type": "string", "format": "uuid" }
                  }
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/orgs/{org_id}": {
      "get": {
        "summary": "Get organization",
        "tags": ["Organizations"],
        "parameters": [
          { "$ref": "#/components/parameters/headers_authorization" },
          { "$ref": "#/components/parameters/org_id" }
        ],
        "responses": {
          "200": {
            "description": "Organization details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/organization" }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      },
      "delete": {
        "summary": "Delete organization",
        "tags": ["Organizations"],
        "parameters": [
          { "$ref": "#/components/parameters/headers_authorization" },
          { "$ref": "#/components/parameters/org_id" }
        ],
        "responses": {
          "200": { "$ref": "#/components/responses/empty" },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/orgs/{org_id}/members": {
      "get": {
        "summary": "List organization members",
        "tags": ["Organizations"],
        "parameters": [
          { "$ref": "#/components/parameters/headers_authorization" },
          { "$ref": "#/components/parameters/org_id" }
        ],
        "responses": {
          "200": {
            "description": "List of members",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "members": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/organization_member" }
                    }
                  }
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      },
      "post": {
        "summary": "Add organization member",
        "tags": ["Organizations"],
        "parameters": [
          { "$ref": "#/components/parameters/headers_authorization" },
          { "$ref": "#/components/parameters/org_id" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": { "type": "string", "format": "uuid" },
                  "role": { "type": "string", "enum": ["owner", "admin", "member"] }
                },
                "required": ["user_id", "role"]
              }
            }
          }
        },
        "responses": {
          "200": { "$ref": "#/components/responses/empty" },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/projects": {
      "get": {
        "summary": "List user's projects",
        "tags": ["Projects"],
        "parameters": [{ "$ref": "#/components/parameters/headers_authorization" }],
        "responses": {
          "200": {
            "description": "List of projects",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "projects": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/project" }
                    }
                  }
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      },
      "post": {
        "summary": "Create project",
        "tags": ["Projects"],
        "parameters": [{ "$ref": "#/components/parameters/headers_authorization" }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "organization_id": { "type": "string", "format": "uuid" },
                  "name": { "type": "string", "minLength": 1, "maxLength": 100 },
                  "public": { "type": "boolean" }
                },
                "required": ["organization_id", "name", "public"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Project created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "project_id": { "type": "string", "format": "uuid" }
                  }
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/projects/{project_id}": {
      "get": {
        "summary": "Get project",
        "tags": ["Projects"],
        "parameters": [
          { "$ref": "#/components/parameters/headers_authorization" },
          { "$ref": "#/components/parameters/project_id" }
        ],
        "responses": {
          "200": {
            "description": "Project details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/project" }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      },
      "delete": {
        "summary": "Delete project",
        "tags": ["Projects"],
        "parameters": [
          { "$ref": "#/components/parameters/headers_authorization" },
          { "$ref": "#/components/parameters/project_id" }
        ],
        "responses": {
          "200": { "$ref": "#/components/responses/empty" },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/projects/{project_id}/members": {
      "get": {
        "summary": "List project members",
        "tags": ["Projects"],
        "parameters": [
          { "$ref": "#/components/parameters/headers_authorization" },
          { "$ref": "#/components/parameters/project_id" }
        ],
        "responses": {
          "200": {
            "description": "List of members",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "members": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/project_member" }
                    }
                  }
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/gateway/config": {
      "post": {
        "summary": "Gateway handshake - get org config",
        "tags": ["Gateway"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "tmp_handshake_token": { "type": "string", "format": "uuid" }
                },
                "required": ["tmp_handshake_token"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Gateway configuration",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "organization_id": { "type": "string", "format": "uuid" },
                    "organization_name": { "type": "string" },
                    "gateway_id": { "type": "string", "format": "uuid" },
                    "gateway_token": { "type": "string" },
                    "projects": {
                      "type": "array",
                      "items": { "type": "string", "format": "uuid" }
                    },
                    "members": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "user_id": { "type": "string", "format": "uuid" },
                          "username": { "type": "string" },
                          "role": { "type": "string", "enum": ["owner", "admin", "member"] }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/gateway/ready": {
      "post": {
        "summary": "Gateway signals ready",
        "tags": ["Gateway"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "gateway_id": { "type": "string", "format": "uuid" }
                },
                "required": ["gateway_id"]
              }
            }
          }
        },
        "responses": {
          "200": { "$ref": "#/components/responses/empty" },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    },
    "/users/search": {
      "get": {
        "summary": "Search users",
        "tags": ["Users"],
        "parameters": [
          { "$ref": "#/components/parameters/headers_authorization" },
          {
            "name": "query",
            "in": "query",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Users matching search",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/user" }
                    }
                  }
                }
              }
            }
          },
          "4XX": { "$ref": "#/components/responses/errors" }
        }
      }
    }
  },
  "components": {
    "responses": {
      "empty": {
        "description": "Success",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "additionalProperties": false
            }
          }
        }
      },
      "errors": {
        "description": "Error response",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/errors" }
          }
        }
      }
    },
    "schemas": {
      "errors": {
        "type": "object",
        "properties": {
          "uuid": { "type": "string" },
          "errors": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "message": { "type": "string" },
                "public": { "type": "boolean" }
              }
            }
          }
        }
      },
      "user": {
        "type": "object",
        "properties": {
          "user_id": { "type": "string", "format": "uuid" },
          "username": { "type": "string", "maxLength": 128 },
          "email": { "type": "string", "format": "email" },
          "picture": { "type": "string", "nullable": true },
          "firstname": { "type": "string", "nullable": true },
          "lastname": { "type": "string", "nullable": true }
        }
      },
      "organization": {
        "type": "object",
        "properties": {
          "organization_id": { "type": "string", "format": "uuid" },
          "owner_user_id": { "type": "string", "format": "uuid" },
          "name": { "type": "string", "maxLength": 100 },
          "created_at": { "type": "string", "format": "date-time" }
        }
      },
      "organization_member": {
        "type": "object",
        "properties": {
          "user_id": { "type": "string", "format": "uuid" },
          "username": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "role": { "type": "string", "enum": ["owner", "admin", "member"] },
          "added_at": { "type": "string", "format": "date-time" }
        }
      },
      "project": {
        "type": "object",
        "properties": {
          "project_id": { "type": "string", "format": "uuid" },
          "organization_id": { "type": "string", "format": "uuid" },
          "name": { "type": "string", "maxLength": 100 },
          "public": { "type": "boolean" },
          "created_at": { "type": "string", "format": "date-time" },
          "gateway_hostname": { "type": "string", "nullable": true }
        }
      },
      "project_member": {
        "type": "object",
        "properties": {
          "user_id": { "type": "string", "format": "uuid" },
          "username": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "added_at": { "type": "string", "format": "date-time" }
        }
      }
    },
    "parameters": {
      "headers_authorization": {
        "in": "header",
        "name": "authorization",
        "description": "JWT access token",
        "required": true,
        "schema": {
          "type": "string",
          "pattern": "^(?:token\\s)?[-A-Za-z0-9_+./]*={0,3}$"
        }
      },
      "org_id": {
        "in": "path",
        "name": "org_id",
        "required": true,
        "schema": { "type": "string", "format": "uuid" }
      },
      "project_id": {
        "in": "path",
        "name": "project_id",
        "required": true,
        "schema": { "type": "string", "format": "uuid" }
      }
    }
  }
}

